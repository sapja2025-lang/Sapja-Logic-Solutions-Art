{% extends 'base.html' %}

{% block title %}Carrito{% endblock %}

{% block content %}

<div class="carrito-view">
    <h2 class="text-center mt-4">Tu carrito</h2>
    {% if productos %}
    <div class="container" style="max-width:1100px;">
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Imagen</th>
                    <th class="text-center">Cantidad</th>
                    <th>Precio</th>
                    <th>Subtotal</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for item in productos %}
                <tr>
                    <td>{{ item.nombre_producto }}</td>
                    <td><img src="{{ url_for('static', filename='uploads/' + item.imagen) }}" width="80" alt="{{ item.nombre_producto }}"></td>
                    <td class="text-center">
                        <form action="{{ url_for('actualizar_carrito', id=item.id_producto) }}" method="POST" class="d-inline-flex align-items-center" style="gap:6px;">
                            <input type="hidden" name="cantidad_actual" value="{{ item.cantidad }}">
                            <button type="submit" name="accion" value="restar" class="btn btn-sm btn-outline-secondary">-</button>
                            <input type="text" name="cantidad_manual" value="{{ item.cantidad }}" class="form-control form-control-sm" style="width:60px; text-align:center;">
                            <button type="submit" name="accion" value="sumar" class="btn btn-sm btn-outline-secondary">+</button>
                        </form>
                    </td>
                    <td>${{ "{:,.0f}".format(item.precio) }}</td>
                    <td>${{ "{:,.0f}".format(item.precio * item.cantidad) }}</td>
                    <td>
                        <a href="{{ url_for('eliminar_del_carrito', id=item.id_producto) }}" class="btn btn-danger btn-sm">Eliminar</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="container" style="max-width:1100px;">
        <div class="d-flex justify-content-between align-items-center mt-3">
            <div>
                <a href="{{ url_for('vaciar_carrito') }}" class="btn btn-warning">Vaciar carrito</a>
            </div>
            <div class="fw-bold">Total: ${{ "{:,.0f}".format(total) }}</div>
        </div>
        <div class="text-end mt-3">
            <a href="{{url_for('pago')}}" class="btn btn-success">Proceder al pago</a>
        </div>
    </div>
    {% else %}
    <p class="text-center fs-5 mt-4">Tu carrito está vacío</p>
    {% endif %}
</div>

{% endblock %}